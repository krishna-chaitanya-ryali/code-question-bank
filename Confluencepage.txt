User Recertification – Add Future-Dated Revocation Support (Backend + Scheduler Changes)

As part of the User Recertification Phase 3, we need to enhance the scheduler logic to support future-dated revocation based on line manager input. Currently, users are revoked immediately when the access status is set to Revoked. With this enhancement, line managers can specify a future “Revoke On Date”, and the backend scheduler will revoke access only on that date.

Enable the scheduler to automatically revoke user access on a specified future date, without immediate deletion, ensuring accurate and controlled access management.

1. Database Changes

Add new column in RECREATE_RESPONSE table:
REVOKE_ON_DATE DATE NULL
2. Scheduler Logic Enhancement (Python Flask Backend)

When scheduler runs:

For every record in RECREATE_RESPONSE where:
ACCESS_STATUS = 'REVOKE'
IS_ACTIVE = 0
REVOKE_ON_DATE IS NOT NULL

Apply logic:
Case 1 — Today < RevokeOnDate
Do NOT revoke.
Do NOT delete from MAP_RAP_USER_ROLE.
Do NOT update USER_TAB.
Scheduler just skips and waits for the correct date.

Case 2 — Today >= RevokeOnDate
Perform full revocation:
Update recreate response table
UPDATE RECREATE_RESPONSE
SET IS_ACTIVE = 1
WHERE REPORTEES_ID = :user_id
  AND RMM_ID = :rmm_id;
 ======================
DELETE FROM MAP_RAP_USER_ROLE
WHERE USER_ID = :user_id
  AND RMM_ID = :rmm_id
  AND ACCESS_LEVEL IN ('CAPTURER', 'INPUTTER', 'VIEWER');
  

3. Manual Trigger Enhancement

Super admin portal already has a Manual Trigger button.
Enhancement required:

Manual trigger must also evaluate future-dated revocations.

UI does not need change except passing the new date column.