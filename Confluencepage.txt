<button id="manual-trigger-btn"
        class="btn btn-default btn-green"
        onclick="UserRecertificationManualTrigger('LM')">
    LM Rework Job
</button>

<button id="manual-trigger-btn2"
        class="btn btn-default btn-green"
        onclick="UserRecertificationManualTrigger('SYSTEM')">
    System Rework Job
</button>


function UserRecertificationManualTrigger(jobType) {

    // Optional: show loader
    showLoader();

    $.ajax({
        url: vHostname + "/run_user_recertification",
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
            trigger_type: jobType   // 'LM' or 'SYSTEM'
        }),
        success: function (response) {

            if (response.status === "error") {
                rapMsgBox_msg(
                    "Error while triggering " + jobType + " recertification: " +
                    response.msg
                );
            }
            else if (response.status === "success") {
                rapMsgBox_msg(
                    jobType + " recertification triggered successfully"
                );
            }
            else {
                rapMsgBox_msg(response.msg);
            }

            hideLoader();
        },
        error: function (error) {
            console.log(error);
            rapMsgBox_msg(
                "Unexpected error while triggering " + jobType + " recertification"
            );
            hideLoader();
        }
    });
}





@recert_bp.route("/trigger-recertification", methods=["POST"])
def manual_trigger_recertification():
    """
    Manual trigger endpoint for user recertification jobs.

    Accepts a trigger_type parameter to execute:
    - 'LM'     → Line Manager–driven recertification
    - 'SYSTEM' → System-driven recertification

    This endpoint is intended for UAT testing and
    administrative intervention only.
    """

    data = request.get_json()
    trigger_type = data.get("trigger_type")

    if trigger_type == "LM":
        process_lm_recertification()
        return jsonify({"status": "LM recertification triggered successfully"})

    elif trigger_type == "SYSTEM":
        process_system_recertification()
        return jsonify({"status": "System recertification triggered successfully"})

    else:
        return jsonify({
            "error": "Invalid trigger_type. Use 'LM' or 'SYSTEM'."
        }), 400
