SELECT COUNT(*)
FROM RECERTIFICATION_EMAIL_LIST rel
WHERE NVL(rel.SYSTEM_REVOKE_DONE_IND, 'N') = 'N'
  AND rel.MAIL_SENT_COUNT = 3
  AND rel.MAIL_SENT_YEAR = :recert_year
  AND (
        SELECT MIN(e2.CREAT_DT)
        FROM RECERTIFICATION_EMAIL_LIST e2
        WHERE e2.LINEMANAGER_ID = rel.LINEMANAGER_ID
          AND e2.MAIL_SENT_COUNT = 1
          AND e2.MAIL_SENT_YEAR = :recert_year
      ) + 31 <= TRUNC(SYSDATE);
