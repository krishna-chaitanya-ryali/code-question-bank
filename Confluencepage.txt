import pandas as pd

excel_file = "rap_metrics.xlsx"
sheet_name = "Sheet1"
output_file = "update_rap_metrics.sql"

df = pd.read_excel(excel_file, sheet_name=sheet_name)

queries = []

for _, row in df.iterrows():
    mapping_id = row["RAP_METRICS_MAPPING_ID"]
    risk_type = row["PRIMARY_RISK_TYPE"]

    # Safety checks
    if pd.isna(mapping_id) or pd.isna(risk_type):
        continue

    # Escape single quotes in risk type (VERY IMPORTANT)
    risk_type = str(risk_type).replace("'", "''")

    query = (
        f"UPDATE RAP_METRICS_DETAILS "
        f"SET PRIMARY_RISK_TYPE = '{risk_type}' "
        f"WHERE RAP_METRICS_MAPPING_ID = {int(mapping_id)};"
    )

    queries.append(query)

with open(output_file, "w") as f:
    f.write("\n".join(queries))

print(f"{len(queries)} UPDATE statements generated successfully.")
