SELECT d.RAP_METRICS_MAPPING_ID, d.MASTER_METRIC_ID AS OLD_ID, m.MASTER_METRIC_ID AS NEW_ID
FROM RAP_METRICS_DETAILS d
JOIN RAP_METRICS_PACK_MAPPING p ON d.RAP_METRICS_MAPPING_ID = p.RAP_METRICS_MAPPING_ID
JOIN RAP_MASTER_METRIC_DETAILS m ON p.METRICS_DISP = m.MASTER_METRIC_NAME
WHERE d.MASTER_METRIC_ID IS NULL;


UPDATE RAP_METRICS_DETAILS d
SET d.MASTER_METRIC_ID = (
    SELECT m.MASTER_METRIC_ID
    FROM RAP_METRICS_PACK_MAPPING p
    JOIN RAP_MASTER_METRIC_DETAILS m ON p.METRICS_DISP = m.MASTER_METRIC_NAME
    WHERE p.RAP_METRICS_MAPPING_ID = d.RAP_METRICS_MAPPING_ID
    AND ROWNUM = 1  -- Optional: if multiple matches exist, take first
)
WHERE d.MASTER_METRIC_ID IS NULL
AND EXISTS (
    SELECT 1
    FROM RAP_METRICS_PACK_MAPPING p
    JOIN RAP_MASTER_METRIC_DETAILS m ON p.METRICS_DISP = m.MASTER_METRIC_NAME
    WHERE p.RAP_METRICS_MAPPING_ID = d.RAP_METRICS_MAPPING_ID
);
