UPDATE RAP r
SET r.RISK_TYPE_ID = (
    SELECT m.NEW_RISK_TYPE_ID
    FROM RISK_TYPE_ID_MAPPING m
    WHERE m.OLD_RISK_TYPE_ID = r.RISK_TYPE_ID
)
WHERE EXISTS (
    SELECT 1
    FROM RISK_TYPE_ID_MAPPING m
    WHERE m.OLD_RISK_TYPE_ID = r.RISK_TYPE_ID
);


UPDATE RAP_MASTER_METRIC_DETAILS rmd
SET rmd.RISK_TYPE_ID = (
    SELECT m.NEW_RISK_TYPE_ID
    FROM RISK_TYPE_ID_MAPPING m
    WHERE m.OLD_RISK_TYPE_ID = rmd.RISK_TYPE_ID
)
WHERE EXISTS (
    SELECT 1
    FROM RISK_TYPE_ID_MAPPING m
    WHERE m.OLD_RISK_TYPE_ID = rmd.RISK_TYPE_ID
);

SELECT * FROM RAP
WHERE RISK_TYPE_ID IN (SELECT OLD_RISK_TYPE_ID FROM RISK_TYPE_ID_MAPPING);

=========================================================================
Create Temporary Mapping Table
We'll create a dedicated mapping table to hold:

OLD_RISK_TYPE_ID: the ID to be replaced

NEW_RISK_TYPE_ID: the ID to which it should be updated

RISK_HEADER: for reference/tracing

CREATE GLOBAL TEMPORARY TABLE RISK_TYPE_ID_MAPPING (
    OLD_RISK_TYPE_ID NUMBER,
    NEW_RISK_TYPE_ID NUMBER,
    RISK_HEADER      VARCHAR2(200)
) ON COMMIT PRESERVE ROWS;

Mapping Table

WITH duplicates AS (
    SELECT RISK_HEADER, RISK_TYPE_ID,
           MIN(RISK_TYPE_ID) OVER (PARTITION BY RISK_HEADER) AS NEW_RISK_TYPE_ID
    FROM RAP_RISK_TYPE
)
SELECT DISTINCT RISK_HEADER, RISK_TYPE_ID AS OLD_RISK_TYPE_ID, NEW_RISK_TYPE_ID
FROM duplicates
WHERE RISK_TYPE_ID != NEW_RISK_TYPE_ID;

insert into the mapping table:

INSERT INTO RISK_TYPE_ID_MAPPING (RISK_HEADER, OLD_RISK_TYPE_ID, NEW_RISK_TYPE_ID)
WITH duplicates AS (
    SELECT RISK_HEADER, RISK_TYPE_ID,
           MIN(RISK_TYPE_ID) OVER (PARTITION BY RISK_HEADER) AS NEW_RISK_TYPE_ID
    FROM RAP_RISK_TYPE
)
SELECT RISK_HEADER, RISK_TYPE_ID, NEW_RISK_TYPE_ID
FROM duplicates
WHERE RISK_TYPE_ID != NEW_RISK_TYPE_ID;

Update Target Tables RAP Using Mapping

MERGE INTO RAP r
USING RISK_TYPE_ID_MAPPING m
ON (r.RISK_TYPE_ID = m.OLD_RISK_TYPE_ID)
WHEN MATCHED THEN
    UPDATE SET r.RISK_TYPE_ID = m.NEW_RISK_TYPE_ID;

Update RAP_MASTER_METRIC_DETAILS Table:

MERGE INTO RAP_MASTER_METRIC_DETAILS rmd
USING RISK_TYPE_ID_MAPPING m
ON (rmd.RISK_TYPE_ID = m.OLD_RISK_TYPE_ID)
WHEN MATCHED THEN
    UPDATE SET rmd.RISK_TYPE_ID = m.NEW_RISK_TYPE_ID;

(Optional) Verify Before Deletion

SELECT * FROM RAP_RISK_TYPE
WHERE RISK_TYPE_ID IN (
    SELECT OLD_RISK_TYPE_ID FROM RISK_TYPE_ID_MAPPING
);

 Delete Duplicate IDs from RAP_RISK_TYPE
 
 DELETE FROM RAP_RISK_TYPE
WHERE RISK_TYPE_ID IN (
    SELECT OLD_RISK_TYPE_ID FROM RISK_TYPE_ID_MAPPING
);
