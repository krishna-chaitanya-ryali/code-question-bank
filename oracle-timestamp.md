1. Create a temp mapping table (optional but safe)
sql
Copy
Edit
CREATE GLOBAL TEMPORARY TABLE MASTER_METRIC_ID_MAPPING (
    MASTER_METRIC_NAME VARCHAR2(500),
    OLD_MASTER_METRIC_ID NUMBER,
    NEW_MASTER_METRIC_ID NUMBER
) ON COMMIT PRESERVE ROWS;
2. Insert duplicates into mapping table
sql
Copy
Edit
INSERT INTO MASTER_METRIC_ID_MAPPING (MASTER_METRIC_NAME, OLD_MASTER_METRIC_ID, NEW_MASTER_METRIC_ID)
WITH duplicates AS (
    SELECT MASTER_METRIC_NAME, MASTER_METRIC_ID,
           MIN(MASTER_METRIC_ID) OVER (PARTITION BY MASTER_METRIC_NAME) AS NEW_MASTER_METRIC_ID
    FROM RAP_MASTER_METRIC_DETAILS
)
SELECT MASTER_METRIC_NAME, MASTER_METRIC_ID, NEW_MASTER_METRIC_ID
FROM duplicates
WHERE MASTER_METRIC_ID != NEW_MASTER_METRIC_ID;
This maps 9087 â†’ 8245, for example.

3. Update RAP_METRICS_DETAILS to use the lowest MASTER_METRIC_ID
sql
Copy
Edit
UPDATE RAP_METRICS_DETAILS d
SET MASTER_METRIC_ID = (
    SELECT m.NEW_MASTER_METRIC_ID
    FROM MASTER_METRIC_ID_MAPPING m
    WHERE m.OLD_MASTER_METRIC_ID = d.MASTER_METRIC_ID
)
WHERE EXISTS (
    SELECT 1
    FROM MASTER_METRIC_ID_MAPPING m
    WHERE m.OLD_MASTER_METRIC_ID = d.MASTER_METRIC_ID
);
4. Delete old (duplicate) entries from RAP_MASTER_METRIC_DETAILS
sql
Copy
Edit
DELETE FROM RAP_MASTER_METRIC_DETAILS
WHERE MASTER_METRIC_ID IN (
    SELECT OLD_MASTER_METRIC_ID FROM MASTER_METRIC_ID_MAPPING
);
ðŸ§ª Optional Check (before deleting):
sql
Copy
Edit
SELECT *
FROM RAP_MASTER_METRIC_DETAILS
WHERE MASTER_METRIC_ID IN (
    SELECT OLD_MASTER_METRIC_ID FROM MASTER_METRIC_ID_MAPPING
);
