SELECT *
FROM RAP_MASTER_METRIC_DETAILS
WHERE MASTER_METRIC_ID IN (
    SELECT OLD_MASTER_METRIC_ID FROM MASTER_METRIC_ID_MAPPING
);

Final SQL Steps (Based on Corrected Requirement):
1. Create Mapping Table
sql
Copy
Edit
CREATE GLOBAL TEMPORARY TABLE MASTER_METRIC_ID_MAPPING (
    MASTER_METRIC_NAME VARCHAR2(500),
    RISK_TYPE_ID NUMBER,
    OLD_MASTER_METRIC_ID NUMBER,
    NEW_MASTER_METRIC_ID NUMBER
) ON COMMIT PRESERVE ROWS;
2. Insert Only True Duplicates (Same Name + Same Risk Type)
sql
Copy
Edit
INSERT INTO MASTER_METRIC_ID_MAPPING (MASTER_METRIC_NAME, RISK_TYPE_ID, OLD_MASTER_METRIC_ID, NEW_MASTER_METRIC_ID)
WITH ranked AS (
    SELECT MASTER_METRIC_ID, MASTER_METRIC_NAME, RISK_TYPE_ID,
           MIN(MASTER_METRIC_ID) OVER (PARTITION BY MASTER_METRIC_NAME, RISK_TYPE_ID) AS NEW_MASTER_METRIC_ID
    FROM RAP_MASTER_METRIC_DETAILS
)
SELECT MASTER_METRIC_NAME, RISK_TYPE_ID, MASTER_METRIC_ID, NEW_MASTER_METRIC_ID
FROM ranked
WHERE MASTER_METRIC_ID != NEW_MASTER_METRIC_ID;
This ensures:

We only collect true duplicates (same name + same risk type)

Keep the smallest ID as master

3. Update All References in RAP_METRICS_DETAILS
sql
Copy
Edit
UPDATE RAP_METRICS_DETAILS d
SET MASTER_METRIC_ID = (
    SELECT m.NEW_MASTER_METRIC_ID
    FROM MASTER_METRIC_ID_MAPPING m
    WHERE m.OLD_MASTER_METRIC_ID = d.MASTER_METRIC_ID
)
WHERE EXISTS (
    SELECT 1
    FROM MASTER_METRIC_ID_MAPPING m
    WHERE m.OLD_MASTER_METRIC_ID = d.MASTER_METRIC_ID
);
4. Delete Only the True Duplicate Master Metric Records
sql
Copy
Edit
DELETE FROM RAP_MASTER_METRIC_DETAILS
WHERE MASTER_METRIC_ID IN (
    SELECT OLD_MASTER_METRIC_ID FROM MASTER_METRIC_ID_MAPPING
);
