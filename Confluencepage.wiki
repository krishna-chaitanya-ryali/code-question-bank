from ldap3 import Server, Connection, ALL, NTLM, SUBTREE

server = Server("ldap://your-ldap-server", get_info=ALL)
conn = Connection(server, user="DOMAIN\\username", password="yourpassword", authentication=NTLM, auto_bind=True)

psid_list = ['45122521', '45122522', '45122523', '45122524']  # example list
search_string = "sAMAccountName"
batch_size = 200

for i in range(0, len(psid_list), batch_size):
    batch = psid_list[i:i + batch_size]

    # âœ… Construct the batch search filter
    search_filter = '(&(objectClass=UserProxy)(objectCategory=UserProxy)(|'
    for psid in batch:
        search_filter += f'({search_string}={psid})'
    search_filter += '))'

    conn.search(
        search_base="DC=yourdomain,DC=com",
        search_filter=search_filter,
        search_scope=SUBTREE,
        attributes=["sAMAccountName", "displayName", "mail", "HSBC-AD-LineManagerID"]
    )

    for entry in conn.entries:
        psid = str(entry.sAMAccountName)
        manager_id = str(entry['HSBC-AD-LineManagerID']) if 'HSBC-AD-LineManagerID' in entry else None
        manager_name = str(entry.displayName) if 'displayName' in entry else None
        manager_mail = str(entry.mail) if 'mail' in entry else None

        print(psid, manager_id, manager_name, manager_mail)
